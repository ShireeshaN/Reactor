<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Expanding active card -> banner (auto loop)</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;background:#000;color:#fff;font-family:Inter,system-ui,Arial;overflow:hidden}
  .frame { position:relative; width:100%; height:100vh; perspective:1400px; }

  /* banner (background) */
  .banner {
    position:absolute; inset:0;
    background-size:cover;
    background-position:center;
    transform: scale(1.06);
    transition: opacity 900ms ease, transform 1600ms cubic-bezier(.2,.9,.25,1);
    opacity:0;
    z-index:1;
    filter: saturate(1.05) contrast(1.02);
  }
  .banner.show { opacity:1; transform: scale(1); }

  /* content text over banner */
  .hero-text {
    position:absolute;
    left:6%;
    bottom:28%;
    z-index:6;
    max-width:420px;
    transition: opacity 400ms ease, transform 600ms ease;
    text-shadow: 0 8px 30px rgba(0,0,0,0.5);
  }
  .hero-text .kicker { letter-spacing:2px; text-transform:uppercase; opacity:.85; font-size:0.85rem }
  .hero-text h1 { font-size:3.6rem; line-height:1.02; margin-top:8px; font-weight:800; }
  .hero-text p { margin-top:10px; opacity:0.9; font-size:1rem }

  /* bottom card row container */
  .cards-area {
    position:absolute;
    right:6%;
    bottom:60px;
    width:760px;        /* width to show 4 cards comfortably */
    overflow:hidden;
    z-index:8;
  }

  .cards {
    display:flex;
    gap:22px;
    align-items:center;
    transition: transform 900ms cubic-bezier(.22,.9,.25,1);
    will-change: transform;
  }

  .card {
    width:160px;
    height:240px;
    border-radius:14px;
    overflow:hidden;
    background:#222;
    flex:0 0 auto;
    position:relative;
    cursor:pointer;
    box-shadow: 0 12px 30px rgba(0,0,0,0.6);
    transition: transform 600ms ease, opacity 400ms ease;
  }
  .card img{ width:100%; height:100%; object-fit:cover; display:block; }

  .card .label {
    position:absolute; left:0; right:0; bottom:0; padding:10px;
    background:linear-gradient(transparent, rgba(0,0,0,0.55));
    color:#fff; font-size:0.85rem;
  }

  /* slight highlight for active slot */
  .slot-highlight {
    position:absolute;
    right:6%;
    bottom:56px;
    width:160px; height:244px;
    border-radius:14px;
    box-shadow: 0 10px 40px rgba(255,255,255,0.04) inset;
    z-index:7;
    pointer-events:none;
    transform:translateX(-36px); /* visual alignment with row */
  }

  /* element used to animate the real card into banner (positioned fixed) */
  .card--anim {
    position:fixed!important;
    left:0; top:0;
    width:160px; height:240px;
    border-radius:14px;
    transform-origin:center center;
    z-index:9;
    will-change: transform, left, top, width, height, opacity;
    transition: transform 1200ms cubic-bezier(.2,.9,.25,1), left 1200ms cubic-bezier(.2,.9,.25,1), top 1200ms cubic-bezier(.2,.9,.25,1), width 1200ms cubic-bezier(.2,.9,.25,1), height 1200ms cubic-bezier(.2,.9,.25,1), opacity 600ms ease;
    box-shadow: 0 40px 90px rgba(0,0,0,0.65);
    overflow:hidden;
  }

  /* responsive */
  @media(max-width:1100px){
    .cards-area{ width:600px; right:4% }
    .hero-text h1{ font-size:3rem }
  }
  @media(max-width:800px){
    .cards-area{ width:92%; left:4%; right:4%; bottom:36px }
    .hero-text{ left:4%; bottom:24% }
    .cards{ gap:14px }
    .card{ width:120px; height:180px }
    .slot-highlight{ left:auto; right:4%; transform:translateX(-14px); width:120px; height:184px }
  }
</style>
</head>
<body>
  <div class="frame">
    <div id="banner" class="banner"></div>

    <div class="hero-text" id="heroText">
      <div class="kicker" id="subTitle">COB LIGHTS</div>
      <h1 id="mainTitle">Premium Kitchen Lighting</h1>
      <p id="desc">Elegant, glare-free COB fixtures that elevate luxury kitchens.</p>
    </div>

    <div class="cards-area">
      <div class="slot-highlight" aria-hidden="true"></div>
      <div class="cards" id="cardsRow">
        <!-- cards: replace data-bg / img src with real product images -->
        <div class="card" data-bg="https://images.unsplash.com/photo-1524758631624-e2822e304c36?auto=format&fit=crop&w=1600&q=80" data-title="COB Recessed" data-sub="Warm White">
          <img src="https://images.unsplash.com/photo-1524758631624-e2822e304c36?auto=format&fit=crop&w=400&q=80" alt="">
          <div class="label">COB Recessed</div>
        </div>

        <div class="card" data-bg="https://images.unsplash.com/photo-1505691723518-36a0a2df2177?auto=format&fit=crop&w=1600&q=80" data-title="Linear COB" data-sub="Trimless">
          <img src="https://images.unsplash.com/photo-1505691723518-36a0a2df2177?auto=format&fit=crop&w=400&q=80" alt="">
          <div class="label">Linear COB</div>
        </div>

        <div class="card" data-bg="https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?auto=format&fit=crop&w=1600&q=80" data-title="Pendant COB" data-sub="Dimmable">
          <img src="https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?auto=format&fit=crop&w=400&q=80" alt="">
          <div class="label">Pendant COB</div>
        </div>

        <div class="card" data-bg="https://images.unsplash.com/photo-1524758631624-3b2c9a7a6b2c?auto=format&fit=crop&w=1600&q=80" data-title="Strip COB" data-sub="CRI 95">
          <img src="https://images.unsplash.com/photo-1524758631624-3b2c9a7a6b2c?auto=format&fit=crop&w=400&q=80" alt="">
          <div class="label">Strip COB</div>
        </div>

        <div class="card" data-bg="https://images.unsplash.com/photo-1519710164239-da123dc03ef4?auto=format&fit=crop&w=1600&q=80" data-title="Accent COB" data-sub="USB Dimmable">
          <img src="https://images.unsplash.com/photo-1519710164239-da123dc03ef4?auto=format&fit=crop&w=400&q=80" alt="">
          <div class="label">Accent COB</div>
        </div>

        <!-- add more cards if you want; row will loop -->
      </div>
    </div>
  </div>

<script>
/*
 Sequence (per loop):
 1) active card = cardsRow.children[0] (first visible slot)
 2) animate that real card from its position into center-scale (backwards illusion)
 3) when expansion reaches its peak -> set banner background to that image & reveal text updated
 4) hide the animating card, then shift the cardsRow left by one card width (visual scroll)
 5) after transition, move the first element to the end and reset translateX
 6) repeat for next card
*/

const cardsRow = document.getElementById('cardsRow');
const banner = document.getElementById('banner');
const heroText = document.getElementById('heroText');
const mainTitle = document.getElementById('mainTitle');
const subTitle = document.getElementById('subTitle');
const desc = document.getElementById('desc');

let speed = 4200;           // total time per card cycle (ms)
let expandDuration = 1400;  // how long expansion animation runs (ms)
let shiftDuration = 900;    // shift row duration
let pauseAfter = 1200;      // small pause after expansion before shifting
let isRunning = true;

// helper to compute visible card width + gap
function getCardStep(){
// card width + gap (use computed styles)
  const card = cardsRow.querySelector('.card');
  const style = window.getComputedStyle(card);
  const margin = parseFloat(style.marginRight || 0);
  const gap = (() => {
    // fallback: get gap by difference of left positions
    const first = cardsRow.children[0].getBoundingClientRect();
    const second = cardsRow.children[1].getBoundingClientRect();
    return second.left - (first.left + first.width);
  })();
  return cardsRow.children[0].offsetWidth + Math.max(0, gap);
}

function animateActiveCard() {
  if (!isRunning) return;

  // the card currently in the active slot is the first child in the row
  const activeCard = cardsRow.children[0];
  if (!activeCard) return;

  // compute bounding rect of card (viewport coords)
  const rect = activeCard.getBoundingClientRect();

  // prepare the card for fixed animation: move it to body, but keep it visually same
  // We'll modify style directly, then animate transform to center+scale
  activeCard.style.willChange = 'transform,left,top,width,height,opacity';
  // store original inline styles to restore later
  const original = {
    position: activeCard.style.position || '',
    left: activeCard.style.left || '',
    top: activeCard.style.top || '',
    width: activeCard.style.width || '',
    height: activeCard.style.height || '',
    transform: activeCard.style.transform || '',
    transition: activeCard.style.transition || '',
    zIndex: activeCard.style.zIndex || '',
    opacity: activeCard.style.opacity || ''
  };

  // set fixed positioning to animate across the viewport
  activeCard.style.position = 'fixed';
  activeCard.style.left = rect.left + 'px';
  activeCard.style.top = rect.top + 'px';
  activeCard.style.width = rect.width + 'px';
  activeCard.style.height = rect.height + 'px';
  activeCard.style.margin = '0';
  activeCard.style.transform = 'translateZ(0) scale(1)';
  activeCard.style.transition = `transform ${expandDuration}ms cubic-bezier(.2,.9,.25,1), left ${expandDuration}ms cubic-bezier(.2,.9,.25,1), top ${expandDuration}ms cubic-bezier(.2,.9,.25,1), width ${expandDuration}ms cubic-bezier(.2,.9,.25,1), height ${expandDuration}ms cubic-bezier(.2,.9,.25,1), opacity 400ms ease`;
  activeCard.style.zIndex = 999;

  // force layout
  void activeCard.offsetWidth;

  // target center and big scale to simulate expanding into banner
  const vw = window.innerWidth;
  const vh = window.innerHeight;
  const targetWidth = vw * 1.08;   // slightly oversize for cover
  const targetHeight = vh * 1.08;
  const targetLeft = (vw - targetWidth) / 2;
  const targetTop = (vh - targetHeight) / 2;

  // apply transform to animate into center/back
  requestAnimationFrame(() => {
    activeCard.style.left = targetLeft + 'px';
    activeCard.style.top = targetTop + 'px';
    activeCard.style.width = targetWidth + 'px';
    activeCard.style.height = targetHeight + 'px';
    activeCard.style.borderRadius = '6px';
    // slightly scale to get extra perception of depth
    activeCard.style.transform = 'translateZ(-600px) scale(1)';
  });

  // mid-timing: when expansion is well under way, update banner
  const bannerSetTime = Math.round(expandDuration * 0.65);
  setTimeout(() => {
    const bg = activeCard.getAttribute('data-bg') || activeCard.querySelector('img').src;
    // set banner image & reveal
    banner.style.backgroundImage = `url('${bg}')`;
    banner.classList.add('show');
    // update text
    const title = activeCard.getAttribute('data-title') || '';
    const sub = activeCard.getAttribute('data-sub') || '';
    subTitle.textContent = sub;
    mainTitle.textContent = title;
    // fade hero text a bit for smoothness then bring it up
    heroText.style.opacity = 0;
    setTimeout(()=> heroText.style.opacity = 1, 220);
  }, bannerSetTime);

  // after expansion finishes, hide the animating card (but we will later restore it and append to end)
  const afterExpand = expandDuration + 80;
  setTimeout(()=>{
    // fade out the animated card (it has become the banner)
    activeCard.style.opacity = 0;
  }, afterExpand - 200);

  // after a short pause, slide the row left by one card step
  setTimeout(()=>{
    // hide banner momentarily after pause? we keep banner visible until next becomes active
    shiftRowOne();
  }, afterExpand + pauseAfter);

  // after shifting and DOM reorder, restore card styles and move it to end
  const totalBeforeReset = afterExpand + pauseAfter + shiftDuration + 50;
  setTimeout(()=>{
    // reset inline style and move card to end of row
    activeCard.style.transition = 'none';
    activeCard.style.position = original.position;
    activeCard.style.left = original.left;
    activeCard.style.top = original.top;
    activeCard.style.width = original.width;
    activeCard.style.height = original.height;
    activeCard.style.transform = original.transform;
    activeCard.style.zIndex = original.zIndex;
    activeCard.style.opacity = original.opacity || '';
    activeCard.style.borderRadius = '';
    // move to end in DOM
    cardsRow.appendChild(activeCard);
    // small timeout to allow DOM changes to settle, then re-enable transitions
    setTimeout(()=> {
      activeCard.style.transition = '';
      activeCard.style.willChange = '';
    },50);
  }, totalBeforeReset);
}

// shift cards row left by one card width and reset by moving first element to end
function shiftRowOne(){
  const step = getStep();
  // animate translate
  cardsRow.style.transition = `transform ${shiftDuration}ms cubic-bezier(.22,.9,.25,1)`;
  cardsRow.style.transform = `translateX(-${step}px)`;

  // after transition: move first child to the end and reset transform
  setTimeout(()=>{
    cardsRow.style.transition = 'none';
    cardsRow.style.transform = 'translateX(0)';
    // move first to end
    if (cardsRow.children.length>0) {
      cardsRow.appendChild(cardsRow.children[0]);
    }
  }, shiftDuration + 20);
}

// compute step: width of first card + gap between first and second
function getStep(){
  const first = cardsRow.children[0];
  const second = cardsRow.children[1] || first;
  const r1 = first.getBoundingClientRect();
  const r2 = second.getBoundingClientRect();
  const gap = Math.max(0, r2.left - (r1.left + r1.width));
  return Math.round(r1.width + gap);
}

/* loop driver */
let loopTimer = null;
function startLoop(){
  // immediate activate first iteration
  animateActiveCard();
  loopTimer = setInterval(()=> animateActiveCard(), speed);
}
function stopLoop(){
  clearInterval(loopTimer);
  loopTimer = null;
}

// start
startLoop();

// allow pause on hover
document.querySelectorAll('.card').forEach(c=>{
  c.addEventListener('mouseenter', ()=> {
    stopLoop();
  });
  c.addEventListener('mouseleave', ()=> {
    startLoop();
  });
});

// handle resize: nothing fancy â€” but optional to update banner scale if needed
window.addEventListener('resize', ()=> {
  // nothing heavy here
});
</script>
</body>
</html>
